# ⏰ 设置定时任务 - 一键完成

## 🎯 目标

设置每天自动抓取数据到 Google Sheets，这样你睡一觉起来就能看到新数据了！

---

## 🚀 快速设置（3步）

### 步骤 1: 创建日志目录

```bash
mkdir -p /Users/tingyuzheng/Downloads/us_china_picker/logs
```

### 步骤 2: 编辑定时任务

```bash
crontab -e
```

### 步骤 3: 添加以下行（复制粘贴）

**每天上午 9:00 执行**：
```cron
0 9 * * * cd /Users/tingyuzheng/Downloads/us_china_picker && GOOGLE_SHEETS_ID="1Cltg8pq-jhtgR6_lysW-gNIe9JSKOh2vCT4Pxo7pcpA" GOOGLE_CREDENTIALS_PATH="/Users/tingyuzheng/Downloads/us_china_picker/google_credentials.json" /usr/bin/python3 daily_collector_to_sheets.py >> /Users/tingyuzheng/Downloads/us_china_picker/logs/daily_collector.log 2>&1
```

**保存并退出**：
- 按 `Esc` → 输入 `:wq` → 按 `Enter`（如果使用 vim）
- 或按 `Ctrl+X` → `Y` → `Enter`（如果使用 nano）

---

## ✅ 验证设置

### 检查定时任务

```bash
crontab -l
```

应该看到刚才添加的那一行。

### 手动测试（立即执行一次）

```bash
cd /Users/tingyuzheng/Downloads/us_china_picker
GOOGLE_SHEETS_ID="1Cltg8pq-jhtgR6_lysW-gNIe9JSKOh2vCT4Pxo7pcpA" GOOGLE_CREDENTIALS_PATH="$(pwd)/google_credentials.json" python3 daily_collector_to_sheets.py
```

应该看到：
```
✅ 成功上传 X 篇文章到 Google Sheets
```

### 查看日志

```bash
tail -f /Users/tingyuzheng/Downloads/us_china_picker/logs/daily_collector.log
```

---

## ⏰ 执行时间说明

**当前设置**：每天上午 9:00

**可以改成其他时间**：

- 凌晨 2:00: `0 2 * * * ...`
- 中午 12:00: `0 12 * * * ...`
- 晚上 23:00: `0 23 * * * ...`

**格式**：`分钟 小时 * * *`（每天）

---

## 📋 工作流程

### 每天自动执行

1. **定时任务运行**（每天 9:00）
2. **抓取当天的文章**（NYT, SCMP, Reuters）
3. **上传到 Google Sheets**（创建新的 Week sheet）
4. **你可以在网站看到**（合并 Google Sheets + RSS）

### 你只需要

- ✅ 打开网站
- ✅ 选择日期范围
- ✅ 下载 Excel

**不需要手动操作！**

---

## 🎉 完成！

设置完成后：

- ✅ 每天自动抓取数据
- ✅ 数据自动上传到 Google Sheets
- ✅ 网站可以随时读取最新数据
- ✅ 同事可以随时下载 Excel

**睡一觉起来，新数据已经在 Google Sheets 里了！** 🎈

---

## 🐛 如果定时任务不执行

### 检查 1: 确认 cron 服务运行

```bash
# Mac 上检查
sudo launchctl list | grep cron
```

### 检查 2: 查看日志

```bash
cat /Users/tingyuzheng/Downloads/us_china_picker/logs/daily_collector.log
```

### 检查 3: 手动测试

如果手动测试成功，但定时任务不执行，可能是：
- 环境变量问题（代码中已设置，应该没问题）
- Python 路径问题（使用绝对路径 `/usr/bin/python3`）

---

## 💡 提示

- **日志文件**会记录每次执行的结果
- **每天执行一次**，避免重复数据
- **数据会累积**，Google Sheets 中会有多个 Week sheet
- **网站会自动读取所有 Week sheet** 并合并

