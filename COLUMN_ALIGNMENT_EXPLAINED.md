# 列对齐（Column Alignment）解释

## 🎯 什么是"列对齐"？

"列对齐"是指确保两个数据表格的**列名和列顺序完全一致**。

## 📊 举个例子

### 场景：现有数据 vs 新数据

**现有数据（Google Sheets 中已有的）**：
```
| URL | Headline | Date | Outlet | Category |
|-----|----------|------|--------|----------|
| ... | ...      | ...  | ...    | ...      |
```

**新数据（要添加的）**：
```
| URL | Date | Headline | Outlet | Category | Nut Graph |
|-----|------|----------|--------|----------|-----------|
| ... | ...  | ...      | ...    | ...      | ...       |
```

### 问题：列名和顺序不一致

1. **列顺序不同**：
   - 现有数据：URL, Headline, Date, Outlet, Category
   - 新数据：URL, Date, Headline, Outlet, Category, Nut Graph

2. **列数量不同**：
   - 现有数据：5 列
   - 新数据：6 列（多了 "Nut Graph"）

### 解决方案：列对齐

代码会：
1. **以新数据的列名为标准**（因为新数据是我们要写入的格式）
2. **重新排列现有数据的列**，使其与新数据一致
3. **如果现有数据缺少某列**，用 `None` 填充
4. **如果现有数据有多余的列**，保留（但可能不会被写入）

### 对齐后的结果

**现有数据（对齐后）**：
```
| URL | Date | Headline | Outlet | Category | Nut Graph |
|-----|------|----------|--------|----------|-----------|
| ... | ...  | ...      | ...    | ...      | None      |
```

**新数据（保持不变）**：
```
| URL | Date | Headline | Outlet | Category | Nut Graph |
|-----|------|----------|--------|----------|-----------|
| ... | ...  | ...      | ...    | ...      | ...       |
```

现在两边的列名和顺序完全一致，可以安全合并了！

## ⚠️ 为什么可能导致数据丢失？

### 问题场景 1: 列对齐时出错

如果代码在重新排列列时出错，可能导致：
- 某些行的数据丢失
- 行数减少（例如从 400 行变成 350 行）

### 问题场景 2: 列名完全不匹配

如果现有数据的列名与新数据的列名完全不同：
- 例如：现有数据有 "标题"，新数据有 "Headline"
- 代码可能无法正确匹配，导致数据丢失

### 问题场景 3: 数据类型不匹配

如果现有数据的格式与新数据不一致：
- 例如：日期格式不同（"2025-11-13" vs "11/13/2025"）
- 可能导致某些行无法正确对齐

## ✅ 现在的保护措施

代码会检查：
1. **对齐前后行数是否一致**（第 213-218 行）
   - 如果行数减少，说明数据丢失了
   - 会抛出错误，阻止清空 sheet

2. **处理前后行数是否一致**（第 224-226 行）
   - 确保整个处理过程中没有丢失数据

3. **合并前后数据量是否一致**（第 307-310 行）
   - 确保合并后的数据量不少于原始数据

## 📝 简单总结

**列对齐 = 让两个表格的列名和顺序一致**

就像整理文件夹：
- 现有数据：文件 A、B、C（顺序：A, B, C）
- 新数据：文件 A、B、C、D（顺序：A, C, B, D）
- 对齐后：统一为 A, B, C, D 的顺序

**为什么重要**：
- 只有列名和顺序一致，才能安全合并数据
- 如果对齐过程中出错，可能导致数据丢失
- 所以需要检查，确保对齐后数据完整

