# 定时任务说明

## ⏰ 执行时间

每天自动执行 **3 次**：

1. **早上 8:07** - 收集当天早上的文章
2. **下午 15:07** - 收集当天下午的文章
3. **晚上 23:37** - 收集当天晚上的文章（包括晚间更新）

## 🔄 自动去重

每次执行都会：
- 抓取当天 00:00:00 到 23:59:59 的所有文章
- 追加到本周的 sheet（例如：`Week 2025-11-03 to 2025-11-10`）
- **自动按 URL 去重**：如果文章已存在，跳过；只追加新文章

## 💻 关于 Cursor

**重要**：**关闭 Cursor 不影响定时任务！**

- ✅ cron 任务是在**系统后台**运行的
- ✅ 不依赖于 Cursor 是否打开
- ✅ 只要**电脑开机**，定时任务就会自动执行
- ✅ 即使关闭 Cursor、关闭终端，定时任务也会运行

## 📋 检查定时任务

### 查看当前定时任务

```bash
crontab -l | grep daily_collector
```

应该看到 3 行：
```
7 8 * * * ...  # 早上 8:07
7 15 * * * ... # 下午 15:07
37 23 * * * ... # 晚上 23:37
```

### 查看执行日志

```bash
tail -f /Users/tingyuzheng/Downloads/us_china_picker/logs/daily_collector.log
```

### 手动测试

```bash
cd /Users/tingyuzheng/Downloads/us_china_picker
GOOGLE_SHEETS_ID="1Cltg8pq-jhtgR6_lysW-gNIe9JSKOh2vCT4Pxo7pcpA" \
GOOGLE_CREDENTIALS_PATH="$(pwd)/google_credentials.json" \
python3 daily_collector_to_sheets.py
```

## ⚠️ 注意事项

1. **电脑需要保持开机**：如果电脑关机或休眠，定时任务不会执行
2. **网络需要连接**：需要网络来抓取 RSS 和上传到 Google Sheets
3. **Python 环境**：确保 pyenv 的 Python 路径正确

## 🎯 工作流程

### 一天的工作流程

- **8:07**：抓取当天文章 → 追加到本周 sheet
- **15:07**：再次抓取当天文章 → 追加（自动去重）
- **23:37**：最后一次抓取当天文章 → 追加（自动去重，捕获晚间更新）

### 一周的工作流程

- **周一**：创建新的 week sheet（例如：`Week 2025-11-10 to 2025-11-17`）
- **周二到周日**：追加到同一个 week sheet
- **下周一**：创建新的 week sheet

## ✅ 优势

1. **三次收集**：覆盖全天，不会遗漏晚间更新
2. **自动去重**：不会重复数据
3. **按周组织**：数据整齐，方便查看
4. **后台运行**：不依赖 Cursor 或终端

---

## 🎉 完成！

现在你的系统会：
- ✅ 每天自动收集 3 次
- ✅ 自动去重
- ✅ 按周组织数据
- ✅ 后台运行（不依赖 Cursor）

