# 为什么每个 Sheet 都少了 20+ 篇文章？

## 🤔 可能的原因分析

### 原因 1: Sheet 内去重清理了重复文章（最可能）

**如果之前的代码没有去重功能**：
- 每个 sheet 可能积累了 20+ 篇重复文章
- 现在代码添加了去重功能（第 240 行）
- 去重后，每个 sheet 减少了 20+ 篇
- **这不是丢失，而是清理重复**

**检查方法**：
- 查看日志中是否有：`"📝 Sheet 内去重：移除 X 篇重复文章"`
- 如果有，说明是清理重复，不是丢失

### 原因 2: URL 格式不一致导致误判为重复

**问题**：
- 如果有些 URL 有尾随空格：`'https://example.com/article '`
- 有些没有：`'https://example.com/article'`
- `drop_duplicates()` 会认为这是两个不同的 URL
- 但实际上应该是同一个
- 如果每个 sheet 有 20+ 篇这样的文章，去重时可能误删

**现在的改进**：
- ✅ 已添加 URL 格式清理（去除空格）
- ✅ 使用清理后的 URL 去重，避免误判

### 原因 3: 列对齐时丢失数据（之前的 bug）

**如果之前的代码没有保护措施**：
- 列对齐时可能丢失数据
- 但之前的代码没有检查
- 导致丢失的数据被写入

**现在的保护措施**：
- ✅ 列对齐后检查行数
- ✅ 如果行数减少，会停止操作，不清空 sheet

### 原因 4: 空白 Sheet 触发了隐藏的 Bug

**如果空白 sheet 导致读取错误**：
- 可能导致 `current_sheet_urls` 不正确
- 导致去重逻辑出错
- 可能误删了不重复的文章

**现在的保护措施**：
- ✅ 空白 sheet 会被跳过
- ✅ 不会导致读取错误

## 🔍 如何确认原因？

### 方法 1: 检查日志

```bash
# 查看去重信息
grep "📝.*去重" logs/daily_collector.log

# 查看错误信息
grep "❌" logs/daily_collector.log

# 查看警告信息
grep "⚠️" logs/daily_collector.log
```

### 方法 2: 检查 Google Sheets 版本历史

1. 打开 Google Sheets
2. File → Version history
3. 查看数据丢失前的版本
4. 对比数据，看看丢失的是哪些文章
5. **检查这些文章是否是重复的**

### 方法 3: 手动检查是否有重复

在 Google Sheets 中：
1. 选择 URL 列
2. 使用"数据" → "删除重复项"
3. 看看有多少重复项

## 💡 最可能的原因

**根据代码分析，最可能的原因是**：

1. **之前的代码没有去重功能**
   - 每个 sheet 积累了 20+ 篇重复文章
   - 现在代码添加了去重功能
   - 去重后，每个 sheet 减少了 20+ 篇
   - **这是正常的清理重复，不是丢失**

2. **URL 格式不一致**
   - 有些 URL 有尾随空格
   - 导致误判为不同 URL
   - 去重时可能误删

## ✅ 现在的改进

1. ✅ 添加了 URL 格式清理（去除空格），避免误判为重复
2. ✅ 添加了多层保护措施，检测数据丢失
3. ✅ 如果检测到数据丢失，会停止操作，不清空 sheet

## 📝 总结

**为什么每个 Sheet 都少了 20+ 篇**：
- **最可能**：清理重复（正常，不是丢失）
- 可能：URL 格式不一致导致误判
- 可能：之前的代码逻辑有问题

**现在的保护措施**：
- ✅ 会检测数据丢失
- ✅ 会停止操作，不清空 sheet
- ✅ 不会再发生类似问题

