# 快速开始：部署指南

## 🚀 完整流程（5 步）

### ✅ 步骤 1: 创建 Google Service Account

1. 访问：https://console.cloud.google.com
2. 创建项目 → 启用 Google Sheets API
3. 创建 Service Account → 下载 JSON 文件
4. 重命名为：`google_credentials.json`

**详细步骤**：见 `创建Google_Service_Account详细步骤.md`

---

### ✅ 步骤 2: 分享 Google Sheets

1. 打开你的 Google Sheets
2. 点击 "Share"（分享）
3. 添加 Service Account 邮箱（从 JSON 中的 `client_email` 获取）
4. 设置权限为 "Editor"

**你的 Spreadsheet ID**: `1Cltg8pq-jhtgR6_lysW-gNIe9JSKOh2vCT4Pxo7pcpA`

---

### ✅ 步骤 3: 配置 Streamlit Cloud Secrets

1. 访问：https://share.streamlit.io
2. 打开你的应用 → Settings → Secrets
3. 粘贴以下内容：

```toml
GOOGLE_SHEETS_ID = "1Cltg8pq-jhtgR6_lysW-gNIe9JSKOh2vCT4Pxo7pcpA"

[google_sheets]
credentials = '''
{
  "type": "service_account",
  "project_id": "your-project-id",
  ...
  粘贴你下载的 google_credentials.json 的全部内容
  ...
}
'''
```

4. 点击 "Save"
5. 等待应用重新部署

**详细步骤**：见 `Streamlit_Cloud_配置指南.md`

---

### ✅ 步骤 4: 设置定时任务（本地）

每天自动抓取数据到 Google Sheets。

**方式 A: 使用 Cron（推荐）**

```bash
# 编辑 crontab
crontab -e

# 添加以下行（每天上午 9:00 执行）
0 9 * * * cd /Users/tingyuzheng/Downloads/us_china_picker && /usr/bin/python3 daily_collector_to_sheets.py >> /Users/tingyuzheng/Downloads/us_china_picker/logs/daily_collector.log 2>&1
```

**方式 B: 使用 LaunchAgent（Mac）**

见 `定时任务设置指南.md`

**重要**：设置环境变量
```bash
export GOOGLE_SHEETS_ID="1Cltg8pq-jhtgR6_lysW-gNIe9JSKOh2vCT4Pxo7pcpA"
export GOOGLE_CREDENTIALS_PATH="/Users/tingyuzheng/Downloads/us_china_picker/google_credentials.json"
```

---

### ✅ 步骤 5: 测试

1. **测试网站**：
   - 打开你的 Streamlit Cloud 网站
   - 勾选 "从 Google Sheets 读取历史数据"
   - 点击 "Generate & Export"
   - 应该能看到数据

2. **测试定时任务**：
   ```bash
   cd /Users/tingyuzheng/Downloads/us_china_picker
   python3 daily_collector_to_sheets.py
   ```

---

## 📋 检查清单

部署前检查：

- [ ] Google Service Account 已创建
- [ ] JSON 文件已下载
- [ ] Google Sheets 已分享给 Service Account（Editor 权限）
- [ ] Streamlit Cloud Secrets 已配置
- [ ] 应用已重新部署
- [ ] 定时任务已设置（可选，但推荐）
- [ ] 测试网站可以读取数据
- [ ] 测试定时任务可以上传数据

---

## 🎯 工作流程

### 日常使用

1. **定时任务**（每天自动）：
   - 抓取 NYT、SCMP、Reuters 当天的文章
   - 上传到 Google Sheets

2. **同事使用网站**（随时）：
   - 打开网站
   - 选择日期范围
   - 勾选 "从 Google Sheets 读取历史数据"
   - 点击 "Generate & Export"
   - 下载 Excel 文件

### 数据流

```
定时任务 → Google Sheets → 网站 → Excel 下载
         (每天自动)      (历史数据)  (实时 RSS)
```

---

## 📚 相关文档

- `创建Google_Service_Account详细步骤.md` - 创建 Service Account
- `Streamlit_Cloud_配置指南.md` - 配置 Streamlit Cloud
- `定时任务设置指南.md` - 设置定时任务
- `Google_Sheets_完整设置指南.md` - Google Sheets 完整设置

---

## 🐛 遇到问题？

### "Google 凭证文件不存在"

**解决方案**：
1. 确保在 Streamlit Cloud Secrets 中配置了 `[google_sheets].credentials`
2. 或确保本地有 `google_credentials.json` 文件
3. 或设置环境变量 `GOOGLE_CREDENTIALS_JSON`

### "无法读取 Google Sheets"

**解决方案**：
1. 检查 Google Sheets 是否已分享给 Service Account
2. 检查 Spreadsheet ID 是否正确
3. 检查 JSON 凭证格式是否正确

### 定时任务不执行

**解决方案**：
1. 检查 cron 服务是否运行
2. 检查日志文件
3. 手动测试脚本是否正常

---

## ✅ 完成！

设置完成后，你的系统将：

- ✅ 每天自动抓取数据到 Google Sheets
- ✅ 网站可以随时读取历史数据
- ✅ 同事可以随时下载最新数据
- ✅ 无需手动维护数据库

🎉 恭喜！系统已就绪！

