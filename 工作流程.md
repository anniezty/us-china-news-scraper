# 工作流程指南

## 标准开发流程

```
1. 本地修改代码
   ↓
2. 本地测试 (streamlit run app_with_sheets_db.py)
   ↓
3. git add . (添加修改)
   ↓
4. git commit -m "描述你的修改"
   ↓
5. git push origin main (手动 push)
   ↓
6. Streamlit Cloud 自动检测并部署 ✨
```

## 详细步骤

### 1️⃣ 本地修改代码
在 Cursor 中编辑文件

### 2️⃣ 本地测试
```bash
# 运行 Streamlit 应用测试
streamlit run app_with_sheets_db.py

# 或测试定时任务脚本
python3 daily_collector_to_sheets.py
```

### 3️⃣ 提交到 GitHub（手动操作）

#### 方式 A：使用命令行（推荐）
```bash
# 查看修改状态
git status

# 添加所有修改（自动忽略敏感文件）
git add .

# 提交修改
git commit -m "feat: 描述你的修改内容"

# 推送到 GitHub
git push origin main
```

#### 方式 B：使用 Cursor/Git GUI
- 在 Cursor 的 Git 面板中：
  1. 点击 "Stage All" 或选中要提交的文件
  2. 输入 commit 消息
  3. 点击 "Commit"
  4. 点击 "Push" 或 "Sync"

### 4️⃣ Streamlit Cloud 自动部署
- ✅ **自动检测**：Streamlit Cloud 会自动检测到 GitHub 的 push
- ✅ **自动部署**：通常在 1-2 分钟内完成部署
- ✅ **无需手动操作**：部署完成后，线上版本会自动更新

## 常用命令速查

```bash
# 查看修改状态
git status

# 查看修改内容
git diff

# 添加所有修改
git add .

# 提交修改
git commit -m "feat: 添加新功能"

# 推送到 GitHub
git push origin main

# 如果 GitHub 有更新，先拉取
git pull origin main

# 查看提交历史
git log --oneline -5
```

## 注意事项

✅ **会自动忽略的文件**（不会上传）：
- `google_credentials.json` - 本地凭证
- `streamlit_secrets_for_cloud.toml` - 本地配置
- `*.log` - 日志文件
- `__pycache__/` - Python 缓存

✅ **会正常上传的文件**：
- 所有 `.py` 代码文件
- `config_en.yaml` 配置文件
- `requirements.txt` 依赖文件
- 其他代码文件

## 故障排除

### 如果 push 失败：
```bash
# 先拉取远程更新
git pull origin main --rebase

# 解决冲突后再次 push
git push origin main
```

### 如果 Streamlit Cloud 没有自动更新：
1. 检查 GitHub 仓库是否有最新 commit
2. 在 Streamlit Cloud 后台查看部署日志
3. 手动触发重新部署（在 Streamlit Cloud 后台）

